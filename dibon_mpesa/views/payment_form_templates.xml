<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="payment_method_form" inherit_id="payment.method_form">
        <xpath expr="//div[@name='o_payment_inline_form']" position="inside">
            <div t-if="provider_sudo.code == 'mpesa_online'" class="mpesa-payment-form">
                <input type="hidden" name="reference" t-att-value="reference"/>
                <input type="hidden" name="amount" t-att-value="amount"/>
                <input type="hidden" name="currency_id" t-att-value="currency.id"/>
                <input type="hidden" name="partner_id" t-att-value="partner_id"/>
                <input type="hidden" name="access_token" t-att-value="access_token"/>
                <input type="hidden" name="payment_option_id" t-att-value="payment_option_id"/>
                <input type="hidden" name="provider_id" t-att-value="provider_sudo.id"/>
                <input type="hidden" name="payment_method" t-att-value="provider_sudo.mpesa_payment_mode"/>

                <!-- STK Push Form -->
                <div t-if="provider_sudo.mpesa_payment_mode == 'stk_push'" class="stk-push-form">
                    <div class="input-group mb-3">
                        <span class="input-group-text">+254</span>
                        <input type="tel" name="mpesa_phone_number" class="form-control" 
                               placeholder="Enter MPesa number e.g. 712345678" required="1"/>
                    </div>
                </div>

                <!-- Manual Payment Form -->
                <div t-if="provider_sudo.mpesa_payment_mode == 'manual_entry'" class="manual-payment-form">
                    <!-- Send Money Instructions -->
                    <div t-if="provider_sudo.manual_payment_method == 'send_money'" class="alert alert-info">
                        <p><strong>Send Money Instructions:</strong></p>
                        <ol>
                            <li>Go to MPesa Menu</li>
                            <li>Select Send Money</li>
                            <li>Enter Phone Number: <strong t-esc="provider_sudo.mpesa_phone_number"/></li>
                            <li>Enter Amount: <strong t-esc="amount"/></li>
                            <li>Enter your MPesa PIN and send</li>
                        </ol>
                    </div>

                    <!-- Till Number Instructions -->
                    <div t-if="provider_sudo.manual_payment_method == 'till'" class="alert alert-info">
                        <p><strong>Till Number Payment:</strong></p>
                        <ol>
                            <li>Go to MPesa Menu</li>
                            <li>Select Lipa na MPesa</li>
                            <li>Select Buy Goods and Services</li>
                            <li>Enter Till Number: <strong t-esc="provider_sudo.mpesa_till_number"/></li>
                            <li>Enter Amount: <strong t-esc="amount"/></li>
                            <li>Enter your MPesa PIN</li>
                            <li>Enter the MPesa receipt number below</li>
                        </ol>
                    </div>

                    <!-- Paybill Instructions -->
                    <div t-if="provider_sudo.manual_payment_method == 'paybill'" class="alert alert-info">
                        <p><strong>Paybill Payment:</strong></p>
                        <ol>
                            <li>Go to MPesa Menu</li>
                            <li>Select Lipa na MPesa</li>
                            <li>Select Pay Bill</li>
                            <li>Enter Business No: <strong t-esc="provider_sudo.mpesa_paybill_number"/></li>
                            <li>Enter Account No: <strong t-esc="provider_sudo.mpesa_paybill_account"/></li>
                            <li>Enter Amount: <strong t-esc="amount"/></li>
                            <li>Enter your MPesa PIN</li>
                            <li>Enter the MPesa receipt number below</li>
                        </ol>
                    </div>

                    <!-- Manual Entry Fields -->
                    <div class="mt-3">
                        <div class="mb-3">
                            <label class="form-label">MPesa Transaction Code</label>
                            <input type="text" name="mpesa_receipt" class="form-control" required="1" 
                                   placeholder="Enter MPesa receipt number"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone Number Used</label>
                            <input type="tel" name="mpesa_phone_number" class="form-control" required="1"
                                   placeholder="254XXXXXXXXX"/>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
</odoo>