<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- SMS Sender ID Kanban View -->
    <record id="view_mpesa_sms_config_kanban" model="ir.ui.view">
        <field name="name">mpesa.sms.config.kanban</field>
        <field name="model">mpesa.sms.config</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_dashboard">
                <field name="name"/>
                <field name="current_balance"/>
                <field name="total_sent"/>
                <field name="success_rate"/>
                <field name="success_count"/>
                <field name="failed_count"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_card">
                                <div class="oe_kanban_details">
                                    <strong class="text-primary"><field name="name"/></strong>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <span class="text-muted">Balance:</span>
                                            <br/>
                                            <strong>KES <field name="current_balance"/></strong>
                                        </div>
                                        <div class="col-6">
                                            <span class="text-muted">Success Rate:</span>
                                            <br/>
                                            <strong><field name="success_rate"/>%</strong>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-4">
                                            <span class="text-muted">Total</span>
                                            <br/>
                                            <strong><field name="total_sent"/></strong>
                                        </div>
                                        <div class="col-4">
                                            <span class="text-success">Success</span>
                                            <br/>
                                            <strong><field name="success_count"/></strong>
                                        </div>
                                        <div class="col-4">
                                            <span class="text-danger">Failed</span>
                                            <br/>
                                            <strong><field name="failed_count"/></strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- MPesa Transactions Dashboard -->
    <record id="view_payment_transaction_dashboard_kanban" model="ir.ui.view">
        <field name="name">payment.transaction.dashboard.kanban</field>
        <field name="model">payment.transaction</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_dashboard" create="false">
                <field name="state"/>
                <field name="amount"/>
                <field name="reference"/>
                <field name="mpesa_phone"/>
                <field name="mpesa_receipt"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div t-attf-class="text-#{record.state.raw_value == 'done' ? 'success' : 'muted'}">
                                <strong><field name="reference"/></strong>
                            </div>
                            <div class="row mt-2">
                                <div class="col-6">
                                    <span class="text-muted">Status:</span>
                                    <br/>
                                    <strong t-attf-class="text-#{record.state.raw_value == 'done' ? 'success' : 'danger'}">
                                        <field name="state"/>
                                    </strong>
                                </div>
                                <div class="col-6">
                                    <span class="text-muted">Amount:</span>
                                    <br/>
                                    <strong>KES <field name="amount"/></strong>
                                </div>
                            </div>
                            <div t-if="record.mpesa_phone.raw_value" class="mt-2">
                                <small class="text-muted">Phone: <field name="mpesa_phone"/></small>
                                <br t-if="record.mpesa_receipt.raw_value"/>
                                <small t-if="record.mpesa_receipt.raw_value" class="text-muted">
                                    Receipt: <field name="mpesa_receipt"/>
                                </small>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- MPesa Stats Dashboard -->
    <record id="view_mpesa_dashboard_kanban" model="ir.ui.view">
        <field name="name">mpesa.dashboard.kanban</field>
        <field name="model">mpesa.sms.config</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_dashboard" create="false">
                <field name="name"/>
                <field name="current_balance"/>
                <field name="total_sent"/>
                <field name="success_rate"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_details">
                                <h4><field name="name"/></h4>
                                <div class="row">
                                    <div class="col-6">
                                        <div>Balance: KES <field name="current_balance"/></div>
                                        <div>Total SMS: <field name="total_sent"/></div>
                                    </div>
                                    <div class="col-6">
                                        <div>Success Rate: <field name="success_rate"/>%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_mpesa_dashboard" model="ir.actions.act_window">
        <field name="name">MPesa Dashboard</field>
        <field name="res_model">mpesa.sms.config</field>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="view_mpesa_dashboard_kanban"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No SMS configurations found
            </p>
        </field>
    </record>

    <!-- SMS Logs Views -->
    <record id="view_mpesa_sms_log_tree" model="ir.ui.view">
        <field name="name">mpesa.sms.log.tree</field>
        <field name="model">mpesa.sms.log</field>
        <field name="arch" type="xml">
            <tree>
                <field name="create_date"/>
                <field name="name"/>
                <field name="sender_id"/>
                <field name="recipient"/>
                <field name="status"/>
                <field name="cost"/>
                <field name="reference"/>
            </tree>
        </field>
    </record>

    <record id="action_mpesa_sms_logs" model="ir.actions.act_window">
        <field name="name">SMS Logs</field>
        <field name="res_model">mpesa.sms.log</field>
        <field name="view_mode">tree,form</field>
    </record>
</odoo>
